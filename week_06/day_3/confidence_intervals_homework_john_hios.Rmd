---
title: "Homework - Confidence Intervals"
output: html_notebook
---


<hr>

# MVP

Now we'll go back to CI creation in the normal fashion. We'll take the `ames` data from the CIs lab earlier today and regard it now as a **sample**, we won't be drawing any smaller samples from within it. This is the usual situation in an analysis: you use all the data available to you!

<br>

**Task 1.**  
Load the data again, `clean_names()`, and re-familiarise yourself with it

<br>

**Ans 1. **

Load libraries:
```{r}
library(tidyverse)
library(infer)
library(janitor)
```

Load and explore the data held in ames.csv
```{r}
ames <- read_csv("data/ames.csv") %>%
  clean_names()
```

```{r}
glimpse(ames)
```


Check data  for NA values
```{r}
ames %>%
  summarise(across(.cols = everything(),
                   .fns = ~sum(is.na(.x))))

```


<br>

**Task 2.**  
Investigate the distribution of `lot_area`. Is the distribution roughly normal? If not, what problems do you find?

<br>

**Ans 2. **

```{r}
ames %>%
  ggplot(aes(x = lot_area)) +
  geom_histogram(col = "white", fill = "steel blue", alpha = 0.7, binwidth = 2000)
```

The distribution is not normal. There's a significant right-skew.

<br>

**Task 3.**  
Compute and visualise a bootstrap sampling distribution for the `mean(lot_area)` of the sold houses.

<br>

**Ans 3. **
```{r}
sample_200 <- ames %>%
  rep_sample_n(size = 200, reps = 1)

sample_200
```

```{r}
summary_sample_200 <- sample_200 %>%
  ungroup() %>%
  summarise(mean_lot_area = mean(lot_area)) 

summary_sample_200
```


<br>

**Task 4.**  
Use your bootstrap distribution to calculate a $95\%$ CI for `mean(lot_area)`, and visualise it on the distribution

<br>

**Ans 4. **
```{r}
# specify that we want to look at tenure variable, 1000 reps, and want to calculate the mean
infer_resample <- sample_200 %>%
  specify(response = lot_area) %>%
  generate(reps = 1000, type = "bootstrap") %>%
  calculate(stat = "mean")

infer_resample
```

```{r}
infer_ci_95 <- infer_resample %>% 
  get_confidence_interval(level = 0.95, type = "percentile")

infer_ci_95
```

```{r}
infer_resample %>%
  visualise(bin = 20) +
  shade_confidence_interval(endpoints = infer_ci_95)
```


<br>

**Task 5.**  
You would like to know the `mean(lot_area)` of the sold houses with higher confidence. Calculate the $99\%$ CI for this variable (you can re-use your bootstrap distribution from above). Is it narrower or broader than the $95\%$ CI? Does that make sense?

<br>

**Ans 5. **
```{r}
infer_ci_99 <- infer_resample %>% 
  get_confidence_interval(level = 0.99, type = "percentile")

infer_ci_99
```

The $99\%$ CI is wider than the $95\%$ CI. The bounds have moved away from the mean lot area.

<br>

**Task 6.**  
Calculate the point estimate of the `mean(lot_area)`

<br>

**Ans 6. **
```{r}
sample_200 <- ames %>%
  rep_sample_n(size = 200, reps = 1)

sample_200

summary_sample_200 <- sample_200 %>%
  ungroup() %>%
  summarise(mean_lot_area = mean(lot_area)) 

summary_sample_200
```


<hr>

# Extension

<br>

**Task 1.**  
Calculate a point estimate and $95\%$ CI for the proportion of houses in the data built before 1920.  Does the number of `reps` you use matter? [Investigate `reps` from $200$ up to $50000$, memory of your laptop permitting].
<br><br>

**Ans. **
```{r}
sample_year_built <- ames %>%
  filter(year_built < 1920) %>% 
  rep_sample_n(size = 100, reps = 1)

sample_year_built

summary_sample_year_built <- sample_year_built %>%
  ungroup() %>%
  summarise(
    mean_lot_area = mean(lot_area),
    lower_bound = quantile(lot_area, probs = 0.025),
    upper_bound = quantile(lot_area, probs = 0.975),
    ci_width = upper_bound - lower_bound
    ) 

summary_sample_year_built
```





```{r}
sample_year_built <- ames %>%
  filter(year_built < 1920) %>% 
  rep_sample_n(size = 100, reps = 200)

sample_year_built

summary_sample_year_built <- sample_year_built %>%
  ungroup() %>%
  summarise(
    mean_lot_area = mean(lot_area),
    lower_bound = quantile(lot_area, probs = 0.025),
    upper_bound = quantile(lot_area, probs = 0.975),
    ci_width = upper_bound - lower_bound
    ) 

summary_sample_year_built
```


```{r}
sample_year_built <- ames %>%
  filter(year_built < 1920) %>% 
  rep_sample_n(size = 100, reps = 1000)

sample_year_built

summary_sample_year_built <- sample_year_built %>%
  ungroup() %>%
  summarise(
    mean_lot_area = mean(lot_area),
    lower_bound = quantile(lot_area, probs = 0.025),
    upper_bound = quantile(lot_area, probs = 0.975),
    ci_width = upper_bound - lower_bound
    ) 

summary_sample_year_built
```




```{r}
sample_year_built <- ames %>%
  filter(year_built < 1920) %>% 
  rep_sample_n(size = 100, reps = 2000)

sample_year_built

summary_sample_year_built <- sample_year_built %>%
  ungroup() %>%
  summarise(
    mean_lot_area = mean(lot_area),
    lower_bound = quantile(lot_area, probs = 0.025),
    upper_bound = quantile(lot_area, probs = 0.975),
    ci_width = upper_bound - lower_bound
    ) 

summary_sample_year_built
```






```{r}
sample_year_built <- ames %>%
  filter(year_built < 1920) %>% 
  rep_sample_n(size = 100, reps = 5000)

sample_year_built

summary_sample_year_built <- sample_year_built %>%
  ungroup() %>%
  summarise(
    mean_lot_area = mean(lot_area),
    lower_bound = quantile(lot_area, probs = 0.025),
    upper_bound = quantile(lot_area, probs = 0.975),
    ci_width = upper_bound - lower_bound
    ) 

summary_sample_year_built
```

```{r}
sample_year_built <- ames %>%
  filter(year_built < 1920) %>% 
  rep_sample_n(size = 100, reps = 10000)

sample_year_built

summary_sample_year_built <- sample_year_built %>%
  ungroup() %>%
  summarise(
    mean_lot_area = mean(lot_area),
    lower_bound = quantile(lot_area, probs = 0.025),
    upper_bound = quantile(lot_area, probs = 0.975),
    ci_width = upper_bound - lower_bound
    ) 

summary_sample_year_built
```







```{r}
sample_year_built <- ames %>%
  filter(year_built < 1920) %>% 
  rep_sample_n(size = 100, reps = 50000)

sample_year_built

summary_sample_year_built <- sample_year_built %>%
  ungroup() %>%
  summarise(
    mean_lot_area = mean(lot_area),
    lower_bound = quantile(lot_area, probs = 0.025),
    upper_bound = quantile(lot_area, probs = 0.975),
    ci_width = upper_bound - lower_bound
    ) 

summary_sample_year_built
```


For more than 200 repetitions, there's very little change in the mean_lot_area calculation and no change observed in the CI calculation. 






